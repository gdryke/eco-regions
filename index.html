<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shapefile on GitHub Pages</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    html, body, #map { height: 100%; margin: 0; }
    .info { position: absolute; top: 10px; left: 10px; background: white; padding: 8px 10px; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,.15); z-index: 1000; }
    .legend { 
      position: absolute; 
      bottom: 20px; 
      right: 20px; 
      background: white; 
      padding: 12px; 
      border-radius: 6px; 
      box-shadow: 0 2px 6px rgba(0,0,0,.15); 
      z-index: 1000;
      font-size: 12px;
      max-width: 250px;
    }
    .legend h4 { 
      margin: 0 0 8px 0; 
      font-size: 14px; 
      color: #2c3e50; 
    }
    .legend-item { 
      display: flex; 
      align-items: center; 
      margin: 4px 0; 
    }
    .legend-color { 
      width: 16px; 
      height: 16px; 
      margin-right: 8px; 
      border: 1px solid #666; 
      border-radius: 2px; 
    }
    .footer {
      position: absolute;
      bottom: 5px;
      right: 20px;
      background: white;
      padding: 6px 10px;
      border-radius: 4px;
      box-shadow: 0 1px 4px rgba(0,0,0,.15);
      z-index: 1000;
      font-size: 11px;
    }
    .footer a {
      color: #007cba;
      text-decoration: none;
    }
    .footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="info">Click features to see ecoregion details</div>
  <div class="legend">
    <h4>EPA Level III Ecoregions</h4>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #E8B4E3;"></div>
      <span>Northern Glaciated Plains</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #E8D5A3;"></div>
      <span>Western Corn Belt Plains</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #B8D4E3;"></div>
      <span>Lake Agassiz Plain</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #A8C5D5;"></div>
      <span>Northern Minnesota Wetlands</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #A8D5A8;"></div>
      <span>Northern Lakes and Forests</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #D4B896;"></div>
      <span>North Central Hardwood Forests</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #F2E6B8;"></div>
      <span>Driftless Area</span>
    </div>
  </div>

  <div class="footer">
    <a href="https://github.com/gdryke/eco-regions/" target="_blank">source here</a>
  </div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <!-- shp.js parses zipped shapefiles in the browser -->
  <script src="https://unpkg.com/shpjs@latest/dist/shp.min.js"></script>

  <script>
    // 1) Create a map
    const map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // 2) Load your zipped shapefile (served from the same repo to avoid CORS issues)
    // Put your file at /data/mn_eco_l4.zip
    shp('data/mn_eco_l4.zip').then(geojson => {
      // shp() returns GeoJSON or a FeatureCollection/array if multiple layers exist
      const asCollection = geojson.type === 'FeatureCollection'
        ? geojson
        : { type: 'FeatureCollection', features: Array.isArray(geojson) ? geojson : [geojson] };

      // 3) Add to map with symbology based on Level 3 ecoregions
      // Color scheme for Minnesota EPA Level 3 Ecoregions
      const getEcoregionStyle = (feature) => {
        const l3Code = feature.properties?.US_L3CODE || '';
        const l3Name = feature.properties?.US_L3NAME || '';
        
        // Color mapping based on EPA Level 3 Ecoregions
        const colorMap = {
          '46': '#E8B4E3', // Northern Glaciated Plains - light purple/pink
          '47': '#E8D5A3', // Western Corn Belt Plains - light tan/beige
          '48': '#B8D4E3', // Lake Agassiz Plain - light blue 
          '49': '#A8C5D5', // Northern Minnesota Wetlands - light blue-gray
          '50': '#A8D5A8', // Northern Lakes and Forests - light green
          '51': '#D4B896', // North Central Hardwood Forests - light brown
          '52': '#F2E6B8'  // Driftless Area - pale yellow
        };
        
        const fillColor = colorMap[l3Code] || '#CCCCCC'; // Default gray
        
        return {
          weight: 1.5,
          opacity: 0.8,
          color: '#666666',      // Border color
          fillColor: fillColor,
          fillOpacity: 0.6
        };
      };

      // Level 4 Ecoregion detailed official descriptions
      const detailedDescriptions = {
        '46e': 'In Minnesota this ecoregion is a transition from the Red River Valley to the Minnesota River Valley and from the Red River Lobe to the Des Moines Lobe of Wisconsin glaciation. There are many lakes including the long Lake Traverse at the head (south end) of the Red River drainage and the long Big Stone Lake at the head of the Minnesota River, both lakes forming the boundary between South Dakota and Minnesota. The topography is gently undulating and rolling with corn and soybean agriculture throughout the ecoregion except for some wetlands in the southern part of the region near the reservoirs and wetlands along the Minnesota River, and in the southeastern part of the region in former Glacial Lake Benson. There is a ridge of slightly higher elevations running east-west through the ecoregion on top of which and south of which is an area of clayey Udert soils that correlate with alternating till plain and drift complex with rolling topography and some steep slopes. About 70% of this ecoregion was corn and soybeans in 2013, and almost 15% wetlands.',
        '46k': 'In Minnesota this ecoregion has a small area which is part of the coteau complex consisting of regions 46k, 46l, and 46m. The gently undulating, hummocky landscape has some lakes, and streams draining both northeast to the escarpment (46l) and southwest to the Big Sioux Basin (46m). Corn and soybeans and some pasture are grown on the loamy, well-drained loess soils, mostly moist prairie Udolls. The presettlement vegetation of tallgrass prairie occupied the drift complex of the Bemis moraine of the Des Moines Lobe and the outwash areas in stream channels. About 65% of this ecoregion was corn and soybeans in 2013, and another almost 20% pasture or grassland.',
        '46l': 'This ecoregion is a narrow band of sloping land, rising 90 to 180 m in elevation from the Minnesota River Valley to the brow of the Prairie Coteau (46k). In Minnesota this ecoregion has several streams that cut narrow, relatively straight channels with some riparian vegetation as they descend northeast to the valley, but the interfluve slopes are primarily moist prairie Udolls on glacial till farmed with corn and soybeans and some pasture. About 65% of this ecoregion was corn and soybeans in 2013 and almost 20% pasture or grassland.',
        '46m': 'In Minnesota this ecoregion is part of the coteau complex with loess on top of mostly pre-Wisconsin glacial till. Along the northeast border of this region is the Buffalo Ridge, the highest elevation land in southern Minnesota, along most of which windmills have been installed. The ridge is till from the Bemis moraine of the Des Moines Lobe. The soils are mainly loamy, well-drained, moist prairie Udolls farmed with corn and soybeans and some pasture. The former tallgrass prairie matrix was interrupted by wet prairie on outwash in several areas. About 65% of this ecoregion was corn and soybeans and 25% pasture or grassland in 2013',
        '46o': 'This ecoregion has only a small portion in Minnesota. It is essentially an extension of the Des Moines Lobe (47b); see that description. Almost 60% of this ecoregion was corn and soybeans and over 25% wetlands in 2013.',
        '47a': 'This ecoregion covers the southwest corner of Minnesota and extends south into Iowa and west into South Dakota. In several respects this ecoregion is a continuation of 46m, the Big Sioux Basin, however it differs in having several sections of scoured bedrock uplands close to the surface, about half of the region covered with mesic Ustolls from pre-Wisconsin glaciation till rather than frigid Udolls, and in being slightly warmer and with slightly more precipitation. This is the highest and driest ecoregion in the Western Corn Belt Plains. The topography is a gently undulating plain with a moderate to thick layer of loess. Till plain covers much of the ecoregion with significant channels of outwash along the Rock River and other streams. The eastern half of the ecoregion has mostly moist prairie Udolls from the Des Moines Lobe and the western half has dryer prairie Ustolls from pre-Wisconsin glaciation. The area is mostly treeless, except for the more moist areas along some stream corridors and on farmstead windbreaks. The dominant land use is corn and soybean agriculture with some pasture. Along the eastern border is a continuation of the Buffalo Ridge from Ecoregion 46m, with windmills along the ridge north of Interstate 90. About 75% of this ecoregion was corn and soybeans and 15% pasture or grassland in 2013.',
        '47b': 'This ecoregion extends from southern Minnesota into north-central Iowa. It was covered with the Des Moines Lobe of the Wisconsin glaciation (last of the Pleistocene glacial periods) and the topography is level to gently rolling. Along the northwestern border the land rises to meet the coteau complex of Ecoregion 46 and then covers the continuation of the higher elevation land to the south of the coteau proper and east of the Loess Prairies (47a). The northern two-thirds of the ecoregion is bisected by the Minnesota River, from northwest to southeast, and its floodplain that is trenched into the glacial till along much of its length before the river turns northeast at Mankato. Much of the eastern border is formed by moraines from both the Des Moines Lobe glaciation and earlier stages of glaciation. The largest part of the ecoregion is in till plain and ground moraine. A large part of the ecoregion is covered with wet prairie Aquolls, with moist prairie Udolls in several areas in the western part of the region, and a small area of wet, clayey Aquerts in former Glacial Lake Minnesota south of Mankato. There are many lakes in the southern part of the ecoregion. This ecoregion, formerly in tallgrass prairie, is the heart of corn and soybeans agriculture in Minnesota. North of the Minnesota River, from east of the Chippewa River to the town of Winthrop there have been sugar beets mixed in with corn and soybeans. About 75% of this ecoregion was corn and soybeans in 2013.',
        '47c': 'This ecoregion is geologically complex and is a transition between the bedrock-dominated landforms of the Rochester/Paleozoic Plateau Upland (52b) and the relatively recent glacial drift landforms of the Des Moines Lobe (47b). The eastern half of the ecoregion is covered with pre-Wisconsin glacial till while the western half is till plain and till-covered moraines with outwash from the Des Moines Lobe. The topography is gently undulating to level and formerly was vegetated with tallgrass prairie in the western and eastern parts of the ecoregion and oak savanna in the central part. Soils are a complex pattern of forest soils (Aqualfs and Udalfs) in the central part of the ecoregion where oak savanna was more dominant, and prairie soils (Aquolls and Udolls) to the east and west, where prairie was more dominant. Row crop agriculture, primarily corn and soybeans, is the dominant land use with pea crops scattered through the area. About 65% of this ecoregion was corn and soybeans and 15% pasture or grassland in 2013.',
        '47g': 'This is a small ecoregion with a similar sized section in Wisconsin. The topography is rolling on the higher elevation ridges, to dissected along drainage courses, to flat in the Mississippi River floodplain and in outwash areas on top of the bluffs back from the edge of the floodplain. The former vegetation was tallgrass prairie and the soils are predominantly sandy and loamy well-drained Udolls. Current land use is corn and soybeans with scattered peas, and some pasture and hay. South of Interstate 94 and east of highway 95 much of the bluffs above the dissected stream corridors leading to the St. Croix River are covered with forest. About 50% of this ecoregion was corn and soybeans, 15% pasture or grassland, and 10% deciduous forest in 2013.',
        '48a': 'This ecoregion is split between Minnesota and North Dakota by the Red River of the North. The topography is flat with a very slight declining gradient to the north and, in Minnesota, to the west. Because the Red River has a poorly defined floodplain and very low gradient, flooding can be a problem. The row crop agriculture that has replaced tallgrass and wet prairies varies in crop selection from year to year both because of changes in market demand and because there are relatively low margin crops due to the cooler growing season compared to, for example, ecoregions within the Western Corn Belt Plains (47). In recent years, corn and soybeans have been grown throughout the ecoregion but sugar beets are an important additional crop in several sections. In the northern part of the ecoregion, sugar beets, wheat, and beans are also grown with corn and soybeans. Soils are mostly wet prairie Aquolls with wet clayey Aquerts in the wetter areas; both types of soils are very productive, have high water tables, and have been ditched and drained. There are some localized areas of saline soils. About 30% of this ecoregion was soybeans, 20% spring wheat, 20% corn, and 10% sugarbeets in 2013.',
        '48b': 'The varying relief of the Beach Ridges and Sand Deltas ecoregion interrupts the extremely flat and intensively farmed land of the Glacial Lake Agassiz Basin (48a). The beach ridges appear as parallel lines, running generally north-south, of sand and gravel formed by wave action on the varying shoreline levels of Glacial Lake Agassiz. A high erosion risk exists in the sand dune areas, and gravel mining has altered the gravelly soils of the beach ridges. Soil types include prairie soils of wet Aquolls, moist Udolls, plus wet, clayey Aquerts, and wet, sandy Aquents. Land use is a mixture of mixed row crops and small grains in several sections, with woody wetlands and deciduous woods dominant in others, all replacing the presettlement vegetation of tallgrass and brush prairie, and aspen stands. About 25% of this ecoregion was wetlands, 20% soybeans, and 10% spring wheat, 9% deciduous forest, 9% other hay crops in 2013.',
        '48d': 'This ecoregion is more similar to the basin ecoregion (48a) than to the ridges ecoregion (48b) in that it is primarily flat but 30 to 90 m higher in elevation than the basin, and separated by the ridges of 48b. Soils are predominantly moist prairie Udolls and dry prairie Ustolls with an area of moderately decomposed Hemists bog in the north of the ecoregion. The tallgrass and wet prairies, and sections of aspen parkland have been replaced by corn, soybeans, and some sugar beets, in the southern part, and by mixtures of row crops, small grains, and pasture and hay in the northern part. The southern part is mostly till plain whereas the northern part is lacustrine, similar to the Glacial Lake Agassiz Basin (48a). About 25% of this ecoregion was wetlands, 25% soybeans, 12% spring wheat, 10% corn, and 9% deciduous forest in 2013.',
        '49a': 'This ecoregion is one of the largest areas of contiguous wetland in the conterminous US. Much of the wetland is peat with corresponding Hemists and Saprists, moderately and completely decomposed organic soils. The peat is interspersed with less organic lacustrine areas of wet forest Aqualfs, wet, sandy Aquents, and small areas of sandy Psamments. Landforms of the peatlands include raised bogs, water tracks, and spring-fen channels. These basic types are combined in various ways, and develop ecologically in different patterns. The climate, being cold (Lake of the Woods frequently claims the coldest temperatures in the conterminous US), and the soils, being frigid and wet, limits crops. Much of the peatland and interspersed areas of wet forest and brushland has not changed since Europeans arrived, although there were many attempts in the early 20th Century to construct ditches across the peatlands to prepare the land for agriculture. Many of the ditches were abandoned after failed attempts at settlement by farmers. There is today evidence of attempts to clear and plant land, particularly southwest of Lake of the Woods and just south and east of Lake of the Woods along the Rainy River. Lakota Sioux occupied the peatlands before the arrival of European settlers into North America in the 17th Century. The Red Lake Ojibwe succeeded the Lakota Sioux as the European settlers pushed the indigenous groups to the west from the East Coast of the continent. The indigenous peoples used many of the plants and animals of the peatlands for food, clothing, and other cultural uses. Lands of the Red Lake Nation, the only indigenous group in Minnesota whose lands avoided allotment into private property and whose lands are held in common, cover slightly less than 20% of the ecoregion. These indigenous people still continue some of their tribal customs and ways of life combined with partial participation in the external capitalist economy. About 75% of this ecoregion was wetlands and 15% open water in 2013.',
        '49b': 'This ecoregion, to the east and partially south of the Peatlands (49a), grades from sections of peat in the northwest to more forest in the northeast and forest along the undulating lobes of the wider southern part. Hemists soils are interspersed in small patches in a number of sections between larger areas of wet forest Aqualfs, and forest Udalfs which predominate in the south. The topography is relatively flat with a gentle rising gradient from the Rainy River on the northern border to elevations as much as 75 m higher in the south. There is some evidence of human landscape modification of vegetation but most land is forest or bog except for some cleared land along the Rainy River and south of it for 15 to 20 km along its tributaries, the Big and Little Fork Rivers, and in the area around International Falls. About 60% of this ecoregion was wetlands and 25% deciduous forest in 2013.',
        '50a': 'There is only a small part of this ecoregion in Minnesota. It is the bed of former Glacial Lake Superior with a plain gently sloping toward Lake Superior but now strongly dissected by the gorges of the Nemadji River as it flows into Wisconsin, and by the lower reaches of the St. Louis River before it enters Lake Superior at Duluth/Superior. The soils are forest Udalfs in the river slopes and bottoms, and sandy forest Orthods and wet forest Aqualfs in the uplands. The presettlement vegetation in the lower Nemadji basin was a mix of white pine, spruce, fir, and aspen; in the rest of the ecoregion it was a complex of patches of white pine and hardwoods, white pine and red pine, aspen-birch, and conifer bogs. Land use and cover today is mainly forest of hardwoods and some conifers, wetlands, and small patches of hay. About 60% of this ecoregion was deciduous and evergreen forest and 20% wetlands in 2013.',
        '50b': 'The majority of this ecoregion is in Minnesota, with an arm extending into Wisconsin. The large Mille Lacs Lake is a dominant feature in the center of the Minnesota portion of the ecoregion. There are major areas of drumlins interspersed with peatlands northeast of Mille Lacs Lake in Aitken and Carlton Counties, in the western lobe of the ecoregion between Brainerd, Harding, and Fort Ripley, and south of Mille Lacs Lake in Mille Lacs and Kanabec Counties. Other areas are a mix of till plain, sand plain, and moraines. There is a noticeable sharp change of elevation of about 60 m along a straight line from Carlton in the northeast, to where the Snake River flows south out of the higher elevations about 25 km north of Mora. This line may be associated with the one billion year-old Mid-Continent Rift, although the rocks of that era are now covered by sedimentary rocks whose western boundary is close to this line through Carlton, Pine, and northern Kanabec Counties. Southeast of this line there are few drumlin features but areas of peatland interspersed with drift complex. The peatlands are mostly on moderately decomposed Hemist soils with forest Udalfs covering large areas along with lesser areas of less developed forest Udepts and sandy forest Orthods in the sandy areas. The presettlement vegetation was a relatively fine-grained mixture of conifer bogs and swamps, aspen and birch, mixed white and red pine, hardwoods south of Mille Lacs Lake, and small areas of jack pine barrens. The ecoregion is currently covered primarily with deciduous forest and wetlands with only small amounts of cropland west of Mille Lacs Lake and in a few other areas. About 40% of this ecoregion was deciduous forest, 40% wetland, and 8% open water in 2013.',
        '50m': 'This ecoregion is distinctive in Minnesota, and one of its best known areas because of the iron mining that, along with two other nearby areas, has provided much of the iron ore for the United States in the last 130 years. The heart of the ecoregion is a narrow range of hills or mountains of exposed Archaen rocks 60 to 90 m above the surrounding area in a line from near Grand Rapids in the southwest to Babbit, about 130 km east-northeast. The iron ore mines in these hills have produced over three billion metric tons of iron ore and have considerable remaining potential deposits, depending upon prices and technology. Adjacent to the southeast of the iron range is a series of copper, nickel, and platinum deposits that are largely undeveloped. The copper resource has the highest value of embodied energy of any natural resource in the state, about five times that of nickel, and about ten times that of the remaining iron ore. The presettlement vegetation was mixed hardwoods and pines in the higher elevations and aspen and birch with patches of conifer bogs and swamps elsewhere. There are now large areas of land barren from mining or full of water in open pits. Most of the remaining area is mixed forest with some shrub and grassland. About 40% of this ecoregion was deciduous and mixed forest, 17% wetlands, and 12% barren in 2013.',
        '50n': 'This ecoregion is well known for its many lakes and rivers and undisturbed landscape, providing innumerable canoe and kayak and camping recreation opportunities. Comprising a large area in northeastern Minnesota adjacent to a similar landscape in Ontario, the ecoregion is an extension of the Archaen and Proterozoic bedrocks of the Canadian Shield with scoured bedrock uplands covered by a thin layer of less developed forest Udept soils. The ecoregion has the highest single elevation in Minnesota (about 700 m) and a large area of high elevation in the eastern part of the ecoregion; the terrain is rolling to undulating with some steep slopes. The presettlement vegetation was jack pine, white and red pine, spruce, fir, birch and aspen forest. Mixed deciduous and evergreen forest and many lakes cover the ecoregion today. The ecoregion hosts Voyageurs National Park in the northwest and the Boundary Waters Canoe Area Wilderness (BWCAW) over much of the rest of the northern half of the ecoregion. BWCAW covers about 36% of the ecoregion. Fire was an important component of the structure of the BWCAW over time until logging and fire suppression began in the 20th Century. This ecoregion has the highest number of lakes among all Level IV regions. About 55% of this ecoregion was mixed, evergreen, and deciduous forest, 25% wetlands, 15% open water in 2013.',
        '50o': 'This ecoregion is primarily in a distinctive former glacial lake bed that is mostly flat peatlands and flat to gently rolling lake plains and till plains. The Mississippi River flows through the ecoregion and in the southern part of the ecoregion occurs the only small area of agriculture, in patches within 7 km of the river. The vast majority of the region is now woody wetland with several areas and small patches of non-wetland forest. The presettlement vegetation was heavily covered with conifer bogs and swamps with aspen and birch along the St. Louis River in the center of the ecoregion and in many patches elsewhere, plus smaller amounts of white and red pine. The peatlands are primarily on moderately decomposed Hemists, with sections of sandy forest Psamments, wet forest Aqualfs near the St. Louis and Mississippi Rivers, and forest Udalfs in a few places. About 60% of this ecoregion was wetlands and 25% mixed and evergreen forest in 2013.',
        '50p': 'This ecoregion in the northeastern Minnesota "Arrowhead" region was formed by till plains, drumlins, moraines, and peatlands from the Rainy and Superior lobes of the Wisconsin glaciation (last of the Pleistocene glacial periods). Much of the central western part of the ecoregion is a northeast-southwest trending drumlin field of alternating woody wetlands in the plain and dryer mixed forest on the drumlin ridges. The land cover in the rest of the ecoregion is also a mixture of patches of forest and wetland with numerous lakes, but with less of a ridge and valley structure as in the drumlin field. The topography is rolling with some steep slopes in the drift complex that covers part of the southeastern section of the ecoregion. Presettlement vegetation was similar to Ecoregion 50o, with smaller patches and less area in conifer bogs and swamps and more in white and red pine, and more in aspen and birch. The soils are less developed forest Udepts with a number of patches of peatland Hemists. The Cloquet River flows through the center of the ecoregion until it meets the St. Louis River near the southwestern border, following the strong gradient in elevation from near 610 m in the northeastern end to about 365 m in the southwestern. About 50% of this ecoregion was wetlands and 40% deciduous, mixed, and evergreen forest in 2013.',
        '50q': 'This ecoregion is moraine country. Multiple moraines from several glacial lobes, the Wadena Lobe in the west and the Rainy and St. Louis Lobes in the east, cover the area. There are also a drumlin field, outwash areas, till plains, lacustrine and drift complex areas on a topography with many short but steep slopes. The ecoregion is primarily covered with well to excessively drained forest Udalf soils with significant areas of sandy forest Psamments, smaller areas of moist but well drained Udoll prairie soils in the west, and somewhat poorly drained wet Aqualfs in the east. The Udolls support the only relatively intense agriculture but there are scattered areas of crops and pasture in the western part of the southern lobe of the ecoregion. The rest of the ecoregion is primarily forest and wetland intermixed with many lakes, the second highest number of lakes among all Minnesota\'s Level IV ecoregions. The lake region from Leech Lake in the north to Brainerd in the south is part of Hart and Ziegler\'s "Lakeshore Resort and Retirement Belt". Presettlement vegetation was a mosaic of aspen and birch, jack pine barrens, white and red pine, small patches of hardwoods, and small patches of conifer bogs and swamps. This ecoregion has the highest elevations in northwest Minnesota, about 580 m in southwest Clearwater County. The low elevations are about 365 m near the Mississippi River that forms the southeastern boundary. About 60% of this ecoregion was deciduous and evergreen forest, and 25% wetlands and open water in 2013.',
        '50r': 'The soils of this ecoregion provide an initial overview. The central east-west belt of the ecoregion is dominated by sandy forest Psamments with most of the northern and southern areas surrounding the Psamments being well-drained forest Udalfs. Patches of moderately decomposed Hemists and two patches in the east of the ecoregion of somewhat poorly drained forest Aqualfs are other noticeable soils. The geomorphology supports the soils patterns with considerable outwash in the central area and till plain, drift complex, moraines, and peat in surrounding areas, on terrain that varies from level to rolling to undulating to hummocky. There are several large lakes, and the upper reaches of the Mississippi River flow through the center of the ecoregion in the sandy outwash areas. The density of lakes by area is among the highest in the state. Presettlement vegetation was a complex mixture of aspen and birch, jack pine barrens, white and red pine, hardwoods, and conifer bogs and swamps. Land use is primarily a mosaic of forest and wetland with some hay and alfalfa agriculture at the western edge and in a small area just east of Bemidji. Compared with ecoregion 50q, the Chippewa Plains have colder winters, warmer summers, fewer numbers of lakes but greater area in lakes, primarily formed from ground and stagnation moraines rather than end moraines, and a less steep topography. About 50% of this ecoregion was deciduous, evergreen, and mixed forest, 30% wetlands, and 13% open water in 2013.',
        '50s': 'The landscape of this ecoregion was formed by deposits of several lobes of the Wisconsin glaciation, the Rainy Lobe in the east, the Koochiching Lobe in the west, and Wadena Lobe in the small southern lobe of the ecoregion. The deposits include till, drift complexes, moraines, organic deposits that became peat, and outwash areas. The topography is undulating to hilly with some areas of steep slopes. Soils are primarily well-drained forest Udalfs with significant areas of somewhat poorly drained forest Aqualfs, smaller areas of sandy forest Psamments, and patches of moderately decomposed Hemists. Presettlement vegetation was a mosaic similar to that in ecoregions 50q and 50r but with more area in hardwoods, particularly in the southern lobe, and somewhat less area in jack pine barrens and white and red pine. Land use today is primarily forest and wetland with small amounts of agriculture and scattered clearings. About 55% of this ecoregion was deciduous, mixed and evergreen forest, 30% wetlands, and 10% open water in 2013.',
        '50t': 'A distinctive and popular ecoregion of Minnesota, the Minnesota shore of Lake Superior is a spectacular landscape of shoreline ascending to high bluffs for most of the ecoregion from Duluth for over 220 km to the Canadian border. The shore of Lake Superior is the lowest elevation in Minnesota, about 180 m, and the highest point in Minnesota, Eagle Mountain at 700 m in Ecoregion 50n, is only about 24 km from the shore. Land cover is largely mixed forest and shrubland with numerous small wetlands, few lakes, and little if any agriculture. The upland rural areas in the ecoregion north of Duluth to around Two Harbors have homesites and some cleared land for hay and pasture. The shore itself has many resorts and campgrounds and is a well developed tourist area. The presettlement vegetation was primarily white and red pine in the southern half and aspen and birch in the northern half with scattered patches of conifer bog and swamp. Close to the shore the soils are forest Udalfs, and poorly developed, shallow Orthents; in the upland the soils are less developed forest Udepts. The landscape formed from the Superior Lobe of the Wisconsin glaciation and is primarily till plain with scoured bedrock upland in the central and far northern parts of the ecoregion. This ecoregion, along with the Blufflands and Coulees (52b), is one of the two areas in Minnesota that support cold water lakes and streams with trout populations, although the native trout have now largely been replaced by introduced salmonid species that are either better suited to current conditions, or out-compete the native species. About 75% of this ecoregion was deciduous, evergreen, and mixed forest and 15% wetlands in 2013.',
        '51a': 'In Minnesota this ecoregion is small and dominated by the Twin Cities metropolitan area. The Mississippi River is joined by the Minnesota River about 10 km below St Anthony Falls in Minneapolis. The topography is rolling to level on outwash terraces and end moraine with some steep slopes on the moraine edges. The soils are forest Udalfs and moist prairie Udolls on which the land use is urban and suburban in much of the ecoregion and mixed row crops and woods to the north and east of the Twin Cities toward the Wisconsin border. The presettlement vegetation was primarily oak openings and savanna and patches of hardwoods. About 22% of this ecoregion was suburban low intensity development, 20% medium and high intensity development, 17% deciduous forest, 11% developed open space, 10% pasture or grassland, and 7% open water in 2013.',
        '51h': 'This ecoregion is dominated by a sandy lake plain and terraces along the Mississippi River. The sand plain formed from outwash from the Mississippi River when it was blocked near St. Cloud by the Grantsburg lobe of the Wisconsin stage of glaciation and formed a course to the east, until it later developed drainage to the south in its present course. The presettlement vegetation was primarily oak openings and savanna in the sandy areas with an area of wet prairie in the eastern part of the ecoregion and with prairie on the terraces near the Mississippi. The soils are sandy forest Psamments in the extensive sandy areas with moist prairie Udolls on the terraces, moderately decomposed Hemists in the formerly wet prairie area, and small patches of forest Udalfs in the center of the ecoregion. Much of the southern half of the ecoregion is covered with sections of suburban development for the Twin Cities. The terraces north of Elk River are largely crop land; the former wet prairie is mainly bog with patches of aspen or other hardwoods. The rest of the northern part of the ecoregion is a mixture of row crops, pasture and hay, and woods. About 25% of this ecoregion was wetlands, 25% deciduous forest, and 20% in corn and soybeans in 2013.',
        '51i': 'This is a distinctive ecoregion in southern Minnesota in its presettlement vegetation and soils. This was an island of oak, maple, basswood and other hardwoods surrounded by prairie and savanna. The woods had many small patches of wet prairie and a number of lakes. The moraines that cover the area have a rolling topography. The predominant soil suborder is forest Udalfs with a patch of wet prairie Aquolls in the southern part of the ecoregion. Within a radius of 30 to 45 km from the center of Minneapolis this ecoregion is a mixture of suburban development, lakes, woods, and pasture. In the rest of the ecoregion there are several sections of corn and soybean agriculture and other sections of mixtures of row crops, woods, lakes and pasture. About 40% of this ecoregion was corn and soybeans, 15% deciduous forest, 15% developed, 13% wetlands, 7% pasture or grassland, and 7% open water in 2013.',
        '51j': 'This lengthy ecoregion is in the western part of the state bordering the Lake Agassiz Plain (48) to the west. The southern section is about 200 km long from slightly west of north to sightly east of south and 30 to 50 km wide. The section north of Detroit Lakes is shaped like a finger pointing east and is about 130 km long and 8 to 14 km wide. The topography is a complex of rolling knobs and kettles in the moraine and outwash landscape. The southern section is mainly moist prairie Udolls formerly covered with tallgrass prairie, hardwoods, and savanna, and the northern section mainly forest Udalfs formerly covered with a mix of patches of hardwoods, oak openings, aspen and birch, and pines. There are several areas of concentrated corn and soybean agriculture but most of the southern part of the ecoregion has interspersed patches of deciduous forest, lakes, wetlands, crops (mainly corn, soybeans, alfalfa), and pasture, while the northern part has mainly deciduous forest, lakes, and alfalfa. The southern section of the ecoregion is part of what Hart and Ziegler call "The Lakeshore Resort and Retirement Belt" with many retirement and second homes especially near the many lakes. About 27% of this ecoregion was corn and soybeans, 24% deciduous or evergreen forest, 13% open water, 11% pasture or grassland and 10% wetlands in 2013.',
        '51k': 'This ecoregion is a transition from hardwood forest and hay farming in the north to corn and soybeans farming in the south. The topography is undulating and gently rolling with sections of elongated hills or drumlins; elevations vary from around 300 m in the river valleys in the east and south to 400 m or more in the northwest, but varies in the northern section from lower elevation outwash areas to higher elevation glacial drift. The presettlement vegetation was prairie in the southwest, aspen-oak woodlands and oak openings and savanna in the southeast, and hardwoods and aspen-oak woodlands in the north (north of the Sauk River). The soils in the north are primarily forest Udalfs, and a mix of Udalfs and moist prairie Udolls in the south. There are few lakes in this ecoregion. This ecoregion is entirely in the "Dairy Belt" where, especially in the northern section, the rolling topography is more likely to be planted with hay crops which then provide feed for dairy cattle. About 30% of this ecoregion was corn and soybeans, 20% deciduous forest, and 20% wetlands in 2013.',
        '51l': 'This ecoregion between the Alexandria Moraines (51j) and the McGrath Till Plain (51k) has similarities to both. The topography is gently rolling with sections of drumlins as in 51k but the elevations are primarily in the 400s of meters as in 51j. The soils are moist prairie Udolls in the southern quarter of the ecoregion and in patches along the western border; forest Udalfs in a large section in the center of the ecoregion and another patch in the northwest; and a substantial section of sandy forest Psamments in the northeast. The moist prairie Udolls soils in the southern quarter are primarily used for corn and soybean farming, but the rest of the ecoregion is a mixture of small sections of cropland (corn, soybeans, dry beans, some of it irrigated) in a matrix of deciduous woods, alfalfa and other hays, and wetlands. The southern three-fourths of the ecoregion is in the Dairy Belt. About 25% of this ecoregion was corn and soybeans, 25% deciduous and evergreen forest, and 20% wetlands in 2013.',
        '52b': 'The bedrock-dominated terrain of this ecoregion is strikingly different from the rest of Minnesota. The topography is a highly dissected landscape of steep ravines (coulees) heading generally east down to the Mississippi River from the plateau to the west (Ecoregion 52c), and descending in multiple directions from ridgetops and bluffs directly above coulees. Much of the picturesque quality of this ecoregion comes from the contrast between the Ordovician sandstone, limestone, and shale bedrock forming much the bluffs and ridgetops, and the steep walls and flat bottoms of the valleys. Soils on the bluffs and ridgetops are loess as Udalfs; alluvium as sandy Psamments or Aquents, or flood-prone Fluvents in the valley bottoms; and rockier soils on the slopes. Presettlement vegetation was oak openings and savanna in the northern and southwestern parts of the ecoregion and diverse hardwoods in the southern part. Contemporary land use is mixed crops and pasture and hay both on the bluffs and ridgetops, and in the valley bottoms, with hardwoods on the slopes. This ecoregion, along with the North Shore Highlands (50t), is one of the two areas in Minnesota that support cold water lakes and streams with trout populations, although the native trout have now largely been replaced by introduced salmonid species that are either better suited to current conditions, or out-compete the native species. About 40% of this ecoregion was deciduous forest, 25% pasture or grassland, and 20% corn and soybeans in 2013.',
        '52c': 'This ecoregion is a transition between the highly dissected landscape of the Bluffland and Coulees (52b) and the Eastern Iowa and Minnesota Drift Plains (47c) of the Western Corn Belt Plains. As in Ecoregion 52b the geomorphology is based on pre-Wisconsin glaciation. The topography is gently rolling and the soils are primarily forest soils (Udalfs) in the northern part and a mix of forest Udalfs and moist prairie Udolls in the southern part; loess grades from thin in the western edge of the ecoregion to thicker at the boundary with Ecoregion 52b. The landscape at presettlement was a mixture of tallgrass prairie, brush prairie, and oak openings and savannas. The land today is extensively farmed with row crops, primarily corn and soybeans, and some pasture and hay. About 45% of this ecoregion was corn and soybeans, 30% pasture or grassland, and 9% deciduous forest in 2013.'
      };

      // Level 4 Ecoregion descriptions mapping (brief summaries)
      const ecoregionDescriptions = {
        '46e': 'This ecoregion consists of stagnation moraines with knob-and-kettle topography and numerous small lakes and wetlands. The area has moderately well-drained to poorly drained soils supporting mixed grassland-agricultural landscape with scattered wetlands and small woodlots.',
        '46k': 'The Prairie Coteau is characterized by relatively high, gently rolling terrain with well-drained soils. This upland area supports native grasslands and agricultural crops, with numerous seasonal and semi-permanent wetlands in low-lying areas providing important waterfowl habitat.',
        '46l': 'This narrow transitional zone features steep slopes and escarpment edges between the Prairie Coteau and adjacent lowlands. The area has well-drained soils and supports a mix of native grassland, scattered trees, and agricultural use where topography permits.',
        '46m': 'The Big Sioux Basin consists of broad, gently sloping valleys and adjacent uplands with moderately well-drained soils. This area supports intensive agriculture, primarily corn and soybeans, with remnant prairie and wetland areas in less suitable agricultural locations.',
        '46o': 'This ecoregion encompasses the broad valley of the Minnesota River and adjacent terraces. The area has fertile, well-drained alluvial soils supporting intensive corn and soybean agriculture, with remnant prairie and wetland areas along the floodplain.',
        '47a': 'The Loess Prairies are characterized by wind-deposited silt (loess) over glacial till, creating fertile, well-drained soils. This area supports intensive agriculture, primarily corn and soybeans, with very few remaining natural areas due to the highly productive soils.',
        '47b': 'The Des Moines Lobe consists of young glacial till plains with relatively flat to gently rolling topography. This area has fertile, poorly to moderately well-drained soils supporting intensive agriculture, with numerous drained wetlands and prairie pothole remnants.',
        '47c': 'This ecoregion features older glacial till plains with more dissected topography than adjacent areas. The moderately well-drained soils support intensive agriculture, primarily corn and soybeans, with some remaining oak woodland and prairie remnants on steeper slopes.',
        '47g': 'These river valleys are characterized by alluvial terraces and floodplains with fertile, well-drained soils. The area supports intensive agriculture in suitable locations, with riparian forests, wetlands, and some remnant prairie areas along the major rivers.',
        '48a': 'This flat, poorly drained basin was the deepest part of glacial Lake Agassiz. The area has very fertile, dark soils supporting agriculture including sugar beets, potatoes, and small grains, with numerous drained wetlands and some remaining prairie pothole wetlands.',
        '48b': 'These ancient beach ridges and deltas of glacial Lake Agassiz create a distinctive landscape of parallel sandy ridges and wet swales. The area supports mixed agriculture and has numerous wetlands, with some remaining prairie and aspen woodland on sandy soils.',
        '48d': 'The Lake Agassiz Plains are flat, poorly drained areas with deep, fertile soils. This region supports intensive agriculture including sugar beets, potatoes, wheat, and corn, with extensive drainage systems and some remaining wetlands and grassland areas.',
        '49a': 'This ecoregion is dominated by extensive peatlands, bogs, and coniferous swamps formed in poorly drained depressions. The area supports black spruce, tamarack, and sphagnum moss communities, with limited human development due to wet conditions and peat soils.',
        '49b': 'This ecoregion, to the east and partially south of the Peatlands (49a), grades from sections of peat in the northwest to more forest in the northeast and forest along the undulating lobes of the wider southern part. Hemists soils are interspersed in small patches in a number of sections between larger areas of wet forest Aqualfs, and forest Udalfs which predominate in the south. The topography is relatively flat with a gentle rising gradient from the Rainy River on the northern border to elevations as much as 75 m higher in the south. There is some evidence of human landscape modification of vegetation but most land is forest or bog except for some cleared land along the Rainy River and south of it for 15 to 20 km along its tributaries, the Big and Little Fork Rivers, and in the area around International Falls. About 60% of this ecoregion was wetlands and 25% deciduous forest in 2013.',
        '50a': 'This ecoregion consists of flat to gently rolling clay plains formed by glacial Lake Duluth. The area has poorly to moderately well-drained clay soils supporting mixed coniferous-deciduous forests, with some agriculture in drier areas and extensive wetland complexes.',
        '50b': 'This upland area features rolling glacial till plains with moderately well-drained soils. The region supports mixed deciduous-coniferous forests dominated by aspen, birch, and conifers, with numerous lakes, wetlands, and some agricultural clearings in suitable areas.',
        '50m': 'The Mesabi Range consists of bedrock-controlled terrain with thin soils over iron formations. This area supports mixed coniferous-deciduous forests, has numerous small lakes and wetlands, and has been extensively modified by iron ore mining activities.',
        '50n': 'This ecoregion features rugged terrain with thin soils over bedrock, numerous lakes, and extensive forest cover. The area supports mixed coniferous-deciduous forests dominated by pine, aspen, and birch, with limited agricultural development due to rocky conditions.',
        '50o': 'These areas consist of broad lake plains formed by glacial lakes, with moderately well-drained to poorly drained soils. The region supports mixed forests, extensive wetland complexes, and some agricultural development in areas with suitable soils.',
        '50p': 'This ecoregion consists of distinctive streamlined hills (drumlins) with moderately well-drained soils. The area supports mixed coniferous-deciduous forests, has numerous small lakes and wetlands between drumlins, and some agricultural use in cleared areas.',
        '50q': 'These moraines consist of rolling to hilly terrain with moderately well-drained soils and numerous lakes. The area supports mixed coniferous-deciduous forests dominated by aspen, birch, and pine, with extensive wetlands and limited agricultural development.',
        '50r': 'The Chippewa Plains feature broad, flat to gently rolling glacial outwash plains with well-drained to moderately well-drained sandy soils. This area supports mixed pine-hardwood forests, has numerous small lakes and wetlands, and some agricultural use.',
        '50s': 'These moraines and uplands consist of rolling to hilly terrain with moderately well-drained soils. The region supports mixed coniferous-deciduous forests, numerous lakes and wetlands, and limited agricultural development due to rocky and uneven terrain.',
        '50t': 'The North Shore Highlands feature rugged terrain with thin soils over bedrock along Lake Superior. This area supports boreal coniferous forests dominated by spruce and fir, has limited agricultural potential, and includes scenic areas important for tourism.',
        '51a': 'These stagnation moraines consist of knob-and-kettle topography with moderately well-drained to poorly drained soils. The area supports deciduous and mixed forests dominated by maple, basswood, and oak, with numerous wetlands and some agricultural clearings.',
        '51h': 'This ecoregion consists of sandy outwash plains and terraces with well-drained soils. The area supports oak woodlands and prairies, has been extensively developed for urban and suburban use, and retains some natural areas in parks and preserves.',
        '51i': 'The Big Woods historically supported extensive deciduous forests on fertile, well-drained soils. This area has been largely converted to agriculture and urban development, with scattered remnants of maple-basswood forests in parks and preserves.',
        '51j': 'This ecoregion features rolling moraines and outwash plains with moderately well-drained to well-drained soils. The area supports mixed deciduous-coniferous forests and prairie, numerous lakes and wetlands, and agricultural use in suitable locations.',
        '51k': 'This ecoregion consists of till plains and drumlin fields with moderately well-drained soils. The area supports deciduous and mixed forests, has numerous small lakes and wetlands, and includes agricultural use in areas with suitable topography.',
        '51l': 'These drumlins and till plains feature rolling terrain with moderately well-drained soils. The region supports deciduous and mixed forests dominated by hardwoods, numerous lakes and wetlands, and agricultural development in cleared areas.',
        '52b': 'The Blufflands and Coulees feature deeply dissected terrain with steep slopes and narrow valleys that escaped glaciation. This area supports deciduous forests dominated by oak and maple, cold-water streams, and limited agricultural use due to steep topography.',
        '52c': 'This upland plateau consists of gently rolling terrain underlain by Paleozoic bedrock with thin soils. The area supports oak woodlands and prairies, has well-drained soils suitable for agriculture, and retains some natural areas on steeper slopes and rocky areas.'
      };

      const layer = L.geoJSON(asCollection, {
        style: getEcoregionStyle,
        onEachFeature: (feature, lyr) => {
          // Build a focused popup showing ecoregion hierarchy
          const props = feature.properties || {};
          const l4Code = props.US_L4CODE || '';
          const description = ecoregionDescriptions[l4Code] || 'Description not available for this ecoregion.';
          const detailedDesc = detailedDescriptions[l4Code] || null;
          
          let popupContent = `
            <div style="max-width: 350px;">
              <h4 style="margin: 0 0 8px 0; color: #2c3e50;">${props.US_L4NAME || 'Unknown Level 4 Ecoregion'}</h4>
              <p style="margin: 4px 0; font-size: 12px;"><strong>Level 4 Code:</strong> ${props.US_L4CODE || 'N/A'}</p>
              <p style="margin: 4px 0; font-size: 12px;"><strong>Level 3:</strong> ${props.US_L3NAME || 'N/A'} (${props.US_L3CODE || 'N/A'})</p>
              <div style="margin-top: 12px; padding: 8px; background-color: #f8f9fa; border-left: 3px solid #007cba; border-radius: 3px;">
                <p style="margin: 0; font-size: 12px; line-height: 1.4; color: #2c3e50;">${description}</p>
              </div>`;

          if (detailedDesc) {
            popupContent += `
              <div style="margin-top: 12px;">
                <button onclick="toggleDetail('detail-${l4Code}')" style="
                  background: #007cba; 
                  color: white; 
                  border: none; 
                  padding: 6px 12px; 
                  border-radius: 4px; 
                  font-size: 11px; 
                  cursor: pointer;
                  transition: background-color 0.2s;
                " onmouseover="this.style.backgroundColor='#005a8b'" onmouseout="this.style.backgroundColor='#007cba'">
                  📖 Learn More (Official EPA Description)
                </button>
                <div id="detail-${l4Code}" style="
                  display: none; 
                  margin-top: 10px; 
                  padding: 10px; 
                  background-color: #fff8e7; 
                  border-left: 3px solid #f39c12; 
                  border-radius: 3px;
                  max-height: 200px;
                  overflow-y: auto;
                ">
                  <p style="margin: 0; font-size: 11px; line-height: 1.4; color: #2c3e50; text-align: justify;">${detailedDesc}</p>
                </div>
              </div>`;
          }

          popupContent += `</div>`;
          
          lyr.bindPopup(popupContent);
          
          // Enhanced hover effects
          lyr.on('mouseover', () => {
            lyr.setStyle({ 
              weight: 3, 
              opacity: 1,
              color: '#2c3e50'
            });
          });
          lyr.on('mouseout', () => {
            lyr.setStyle(getEcoregionStyle(feature));
          });
        }
      }).addTo(map);

      // 4) Fit the map to the data
      try { map.fitBounds(layer.getBounds(), { padding: [10,10] }); } catch (e) {}
    }).catch(err => {
      console.error(err);
      alert('Failed to load shapefile. See console for details.');
    });

    // Function to toggle detailed description visibility
    window.toggleDetail = function(elementId) {
      const element = document.getElementById(elementId);
      const button = element.previousElementSibling;
      
      if (element.style.display === 'none') {
        element.style.display = 'block';
        button.innerHTML = '📖 Hide Details';
      } else {
        element.style.display = 'none';
        button.innerHTML = '📖 Learn More (Official EPA Description)';
      }
    };
  </script>
</body>
</html>

